
CXX := @CXX@
INSTALL := @INSTALL@

CXXFLAGS := @CXXFLAGS@
CPPFLAGS := @CPPFLAGS@

EXCEPTION_OBJS := not_found_exception.o unsupported_exception.o	\
syntax_exception.o

DATABASE_OBJS := database.o database_result_set.o database_parameter.o

SHIELD_OBJS := transform_common.o transform_yacc.o transform_lex.o	\
shield.o transform_printable.o transform_select.o transform_identity.o	\
transform_text.o transform_create_table.o transform_insert.o		\
transform_auto_increment.o transform_create_index.o			\
transform_drop_table.o transform_date_function.o transform_interval.o	\
transform_natural.o transform_print_package.o transform_chain.o		\
introspection_table.o introspection_column.o				\
introspection_column_type.o $(DATABASE_OBJS) \
util.o $(EXCEPTION_OBJS)

SHIELD_LEX_TEST_OBJS := transform_lex_test.o 
INTROSPECTION_TEST_OBJS := introspection_test.o	\
introspection_table.o introspection.o
DATABASE_TEST_OBJS := database_test.o $(DATABASE_OBJS) util.o $(EXCEPTION_OBJS)

LDFLAGS := @LDFLAGS@ -ll -locci -lclntsh -lpthread

PROGRAMS := shield shield_lex_test shield_make_package_string

all: shield

shield: $(SHIELD_OBJS)
	$(CXX) $(SHIELD_OBJS) -o $@ $(LDFLAGS)

shield_make_package_string: shield_make_package_string.cc
	$(CXX) shield_make_package_string.cc -o $@

shield_lex_test: $(SHIELD_LEX_TEST_OBJS)
	$(CXX) $(SHIELD_LEX_TEST_OBJS) -o $@ $(LDFLAGS)

introspection_test: $(INTROSPECTION_TEST_OBJS)
	$(CXX) $(INTROSPECTION_TEST_OBJS) -o $@ $(LDFLAGS)

database_test: $(DATABASE_TEST_OBJS)
	$(CXX) $(DATABASE_TEST_OBJS) -o $@ $(LDFLAGS)

transform_lex.cc: transform_lex.y
	flex -i -otransform_lex.cc transform_lex.y 

transform_yacc.cc: transform_yacc.y
	bison -d transform_yacc.y -o transform_yacc.cc --report=state

transform_yacc.hh: transform_yacc.cc

transform_print_package.cc: shield_make_package_string shield_package.sql
	echo "#include \"transform.hh\"" >$@
	echo "void shield::transform::print_package ()" >>$@
	echo "{" >>$@
	echo -n "	cout << " >>$@
	./shield_make_package_string < shield_package.sql >>$@
	echo ";" >>$@
	echo "}" >>$@

shield.o: transform_yacc.hh

#
# These dependencies make sure that autoconf and configure are run
# when the source code for the build configuration has changed.
#

configure: configure.ac
	./config.status --recheck

Makefile: Makefile.in configure
	./config.status


#
# Update dependencies
#
depend:
	makedepend -fMakefile.depend -Y $(subst .o,.cc,$(SHIELD_OBJS))
.PHONY: depend

#
# Include automatically generated dependencies (see depend target)
#

clean:
	rm -f *.o 
	rm -f transform_yacc.cc transform_yacc.hh 
	rm -f transform_lex.cc transform_lex.hh
	rm -f $(PROGRAMS)
	rm -f transform_print_package.cc

include Makefile.depend
